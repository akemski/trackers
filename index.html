<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Club Hub</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; background: #0b0b10; color: #eee; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 32px 16px; }
    .card { background: #141420; border: 1px solid #24243a; border-radius: 16px; padding: 20px; }
    h1,h2,h3 { margin: 0 0 10px; }
    .muted { color:#b9b9d6; font-size: 14px; }
    label { display:block; margin-top: 10px; }
    input {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #2b2b45;
      background:#0f0f18;
      color:#eee;
      outline: none;
    }
    input:focus { border-color:#7c5cff; }
    button { padding: 12px 14px; border-radius: 12px; border: 0; cursor: pointer; }
    .btn { background: #7c5cff; color: white; }
    .btn2 { background: #2a2a44; color: white; }
    .row { display:flex; gap:12px; margin-top:12px; flex-wrap: wrap; }
    .err { color:#ff6b6b; margin-top:10px; display:none; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin-top: 16px; }
    .box { background:#121220; border:1px solid #24243a; border-radius: 16px; padding: 16px; }
    .pill {
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px; border-radius: 999px;
      background:#0f0f18; border:1px solid #2b2b45;
      font-size: 13px; color:#d9d9ff;
    }
    .topbar { display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap: wrap; }
    .hidden { display:none !important; }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- LOGIN -->
    <section id="loginPage" class="card">
      <h1>Club Hub âœ¨</h1>
      <p class="muted">Login mit Username + Passwort.</p>

      <form id="loginForm">
        <label class="muted" for="username">Username</label>
        <input id="username" required placeholder="z.B. Marie" autocomplete="username" />

        <label class="muted" for="password">Passwort</label>
        <input id="password" type="password" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" />

        <div class="row">
          <button class="btn" type="submit">Login</button>
        </div>

        <div id="loginError" class="err">Login fehlgeschlagen ðŸ¥²</div>
      </form>
    </section>

    <!-- DASHBOARD -->
    <section id="dashPage" class="card hidden" style="margin-top:16px;">
      <div class="topbar">
        <div>
          <h2>Dein Club Hub</h2>
          <p class="muted" style="margin:6px 0 0;">WÃ¤hle einen Bereich:</p>
        </div>

        <div class="row" style="margin-top:0;">
          <span class="pill" id="userPill">ðŸ‘¤ â€”</span>
          <span class="pill" id="rolePill">ðŸ”‘ â€”</span>
          <button class="btn2" id="logoutBtn" type="button">Logout</button>
        </div>
      </div>

      <div class="grid">
        <div class="box">
          <h3>Forum</h3>
          <p class="muted">AnkÃ¼ndigungen, Regeln, Chat.</p>
          <button class="btn" onclick="location.href='forum.html'">Ã–ffnen</button>
        </div>

        <div class="box">
          <h3>Dressur</h3>
          <p class="muted">Trainings, Lektionen, Tipps.</p>
          <button class="btn" onclick="location.href='dressur.html'">Ã–ffnen</button>
        </div>

        <div class="box">
          <h3>Trail</h3>
          <p class="muted">Routen, Challenges, Screens.</p>
          <button class="btn" onclick="location.href='trail.html'">Ã–ffnen</button>
        </div>

        <!-- Instructor-only (oder hÃ¶her) -->
        <div class="box" id="instructBox">
          <h3>Instructor Corner</h3>
          <p class="muted">ÃœbungsplÃ¤ne, Aufgaben, Bewertungen.</p>
          <button class="btn" onclick="location.href='instruct.html'">Ã–ffnen</button>
        </div>

        <!-- Leader/Admin-only -->
        <div class="box" id="leaderBox">
          <h3>Leitung</h3>
          <p class="muted">Organisation, Termine, Teams.</p>
          <button class="btn" onclick="location.href='leader.html'">Ã–ffnen</button>
        </div>

        <!-- Admin-only -->
        <div class="box" id="adminBox">
          <h3>Admin Panel</h3>
          <p class="muted">User verwalten, Rollen setzen.</p>
          <button class="btn" onclick="location.href='admin.html'">Ã–ffnen</button>
        </div>
      </div>
    </section>

  </div>

  <!-- Firebase (Compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // âœ… 1) Firebase Config eintragen
    const firebaseConfig = {
      apiKey: "AIzaSyASTwGk7GYqOaDWTRB77Qw5aE_RnWzcHic",
      authDomain: "trackers-ce3fb.firebaseapp.com",
      projectId: "trackers-ce3fb"
      // storageBucket / appId / senderId kannst du drin lassen, aber fÃ¼r das hier reichen die 3 meist schon
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // DOM
    const loginPage = document.getElementById("loginPage");
    const dashPage = document.getElementById("dashPage");
    const loginForm = document.getElementById("loginForm");
    const loginError = document.getElementById("loginError");
    const logoutBtn = document.getElementById("logoutBtn");

    const userPill = document.getElementById("userPill");
    const rolePill = document.getElementById("rolePill");

    const instructBox = document.getElementById("instructBox");
    const leaderBox = document.getElementById("leaderBox");
    const adminBox = document.getElementById("adminBox");

    // Rollen-Hierarchie (wer darf was sehen)
    const roleRank = {
      member: 1,
      instruct: 2,
      leader: 3,
      admin: 4
    };

    function normalizeRole(role) {
      const r = (role || "").toLowerCase().trim();
      return roleRank[r] ? r : "member";
    }

    function applyRoleUI(role) {
      const r = normalizeRole(role);

      // default: alles erstmal verstecken, dann freischalten
      instructBox.classList.add("hidden");
      leaderBox.classList.add("hidden");
      adminBox.classList.add("hidden");

      // instruct corner: instruct oder hÃ¶her
      if (roleRank[r] >= roleRank.instruct) instructBox.classList.remove("hidden");

      // leitung: leader oder hÃ¶her
      if (roleRank[r] >= roleRank.leader) leaderBox.classList.remove("hidden");

      // admin panel: nur admin
      if (r === "admin") adminBox.classList.remove("hidden");

      rolePill.textContent = "ðŸ”‘ " + r;
    }

    function showDash(username, role) {
      loginPage.classList.add("hidden");
      dashPage.classList.remove("hidden");

      userPill.textContent = "ðŸ‘¤ " + (username || "â€”");
      applyRoleUI(role);
    }

    function showLogin() {
      dashPage.classList.add("hidden");
      loginPage.classList.remove("hidden");

      userPill.textContent = "ðŸ‘¤ â€”";
      rolePill.textContent = "ðŸ”‘ â€”";
    }

    // âœ… Login: Username + Passwort aus Firestore checken â†’ dann Anonymous Auth
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      loginError.style.display = "none";

      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value;

      try {
        const snap = await db
          .collection("users")
          .where("username", "==", username)
          .limit(1)
          .get();

        if (snap.empty) throw new Error("User nicht gefunden");

        const userDoc = snap.docs[0];
        const data = userDoc.data();

        if ((data.password || "") !== password) throw new Error("Falsches Passwort");

        // Role speichern (damit wir sie nach Reload wieder haben)
        const role = normalizeRole(data.role);
        localStorage.setItem("clubUser", username);
        localStorage.setItem("clubRole", role);

        // Anonymous sign-in (Session)
        await auth.signInAnonymously();

        // UI direkt updaten
        showDash(username, role);

      } catch (err) {
        console.error(err);
        loginError.style.display = "block";
        loginError.textContent = "Login fehlgeschlagen ðŸ¥²";
      }
    });

    // âœ… Session check
    auth.onAuthStateChanged((user) => {
      if (user) {
        const username = localStorage.getItem("clubUser");
        const role = localStorage.getItem("clubRole");
        showDash(username, role);
      } else {
        localStorage.removeItem("clubUser");
        localStorage.removeItem("clubRole");
        showLogin();
      }
    });

    // âœ… Logout
    logoutBtn.addEventListener("click", async () => {
      await auth.signOut();
    });
  </script>
</body>
</html>
